### 项目是NL-STV_test的升级版本
原项目链接：https://github.com/Allforblue/NL-STV_test.git

### 基于LLM的时空数据可视化平台NL-STV
版本号：0.2.1


### 全新架构
前后端分离：
- 后端：FastAPI
- 前端：React + Vite

#### 项目组织架构
```text
NL-STV_v2/
├── backend/                # 后端核心 (FastAPI)
│   ├── main.py             # 后端入口，配置 FastAPI 路由与中间件
│   ├── api/                # API 接口层
│   │   ├── endpoints/
│   │   │   ├── chat.py     # 处理 AI 对话、指令解析
│   │   │   ├── data.py     # 处理文件上传、数据预览、元数据获取
│   │   │   └── session.py  # 管理用户会话状态、上下文清除
│   │   └── deps.py         # 依赖注入（如 AIClient 实例化）
│   ├── core/               # 升级后的核心逻辑层 (保留并增强原有模块)
│   │   ├── ingestion/      # 数据接入 (原有)
│   │   ├── profiler/       # 数据分析
│   │   │   ├── semantic_analyzer.py
│   │   │   └── relation_mapper.py   # [新增] 分析多表之间的关联关系
│   │   ├── generation/     # 代码与指令生成
│   │   │   ├── code_generator.py    # 生成绘图/分析逻辑
│   │   │   ├── viz_editor.py        # 基于上下文的增量修改
│   │   │   └── dashboard_planner.py # [新增] 规划多维看板布局与组件
│   │   ├── execution/      # 代码执行与结果捕获
│   │   │   ├── executor.py
│   │   │   └── insight_extractor.py # [新增] 提取执行结果特征，生成文字洞察
│   │   └── llm/            # LLM 客户端
│   ├── schemas/            # Pydantic 模型 (定义前后端交互的 JSON 格式)
│   │   ├── dashboard.py    # 看板布局协议 (Map + Charts + Insights)
│   │   └── interaction.py  # 多模态交互协议 (Text + BBox)
│   ├── services/           # 业务逻辑编排层 (粘合 core 模块)
│   │   ├── session_service.py # 维护内存/Redis 中的会话上下文
│   │   └── workflow.py     # 定义从提问到看板生成的完整流水线
│   └── data_sandbox/       # 数据沙箱 (存储上传的临时文件)
├── frontend/               # 前端看板 (React + Vite)
│   ├── public/
│   ├── src/
│   │   ├── components/     # UI 组件
│   │   │   ├── map/        # Deck.gl / Mapbox 地图组件 (支持框选交互)
│   │   │   ├── charts/     # ECharts 统计图组件 (支持联动)
│   │   │   ├── chat/       # AI 聊天交互窗口
│   │   │   └── dashboard/  # 看板网格容器 (动态布局)
│   │   ├── store/          # 全局状态管理 (Zustand/Redux) - 管理 BBox, 选中的数据
│   │   ├── hooks/          # 自定义 Hook (处理地图事件捕捉、API 请求)
│   │   ├── api/            # Axios 接口封装
│   │   └── App.tsx         # 页面主入口
│   ├── package.json
│   └── vite.config.ts
├── config/                 # 配置文件
│   ├── config.yaml         # 系统参数、模型配置
│   └── prompts/            # 专门存放各类 Agent 的提示词模板
├── logs/                   # 日志文件
├── .env                    # 环境变量 (API Keys, DB URLs)
├── docker-compose.yml      # 一键部署配置 (Backend + Frontend + Redis)
└── requirements.txt        # 后端依赖
```

### 项目任务书

#### 研究内容
本课题旨在针对当前时空数据分析门槛高、可视化交互复杂等痛点，设计并实现一套基于大语言模型驱动（LLM）的时空数据可视化原型平台。研究内容主要涵盖以下五个方面：

1. 系统框架设计与时空数据标准化接入研究。
针对时空数据多维度、异构化的特性，设计一套分层解耦的平台架构。研究如何构建时空数据管理层，实现对多源数据的元数据提取与标准化描述，为大模型提供清晰的数据“语义地图”。同时，初步探索基于LLM的任务规划机制，将复杂的用户需求拆解为可执行的底层数据处理步骤。

2. 基于LLM的时空意图识别与指令映射研究。
重点探讨如何优化大模型对地理空间语言的理解能力。研究如何将用户关于“空间范围”、“时间尺度”及“属性过滤”的自然语言描述，精准解析并映射为规范的数据查询逻辑与可视化配置参数，实现从“人类自然语言”到“机器执行指令”的智能转换。

3. 多维时空看板自动构建与智能分析解释。
研究时空数据在 Web 端的动态渲染策略与多图表联动方案。开发可视化配置自动生成模块，根据大模型对数据的语义理解，自动匹配最适宜的表现形式。在此基础上，利用大模型的文本生成能力，构建可视化结果自动分析模块，针对生成的图表自动提取核心特征并提供文字形式的深度解释，帮助用户快速理解可视化结果背后反映的业务问题。

4. 基于多模态触发的二次交互与语义钻取机制。
研究如何实现“自然语言”与“地图UI操作”协同驱动的深度交互。重点构建多模态交互映射机制，支持用户通过自然语言指令或在系统提供的地图上进行手动框选、点击等交互行为，触发系统进行语义钻取。研究如何维持交互过程中的上下文状态，使系统能够根据用户反馈进一步细化查询粒度（例如：从全市拥堵概览下钻至特定路段的流量来源分析），实现从“初步感知”到“深度溯源”的交互闭环。

5. 原型系统集成与多维度实证评价。
整合上述研究模块，开发一套完整的一站式时空数据智能可视化原型系统。选取城市交通流分析等典型场景进行实证测试。不仅从技术维度评估系统在指令解析准确率、渲染响应速度等方面的性能，还将通过用户可用性测试，验证大模型驱动模式在降低时空分析门槛、提升非专业用户操作效率方面的实际价值。

